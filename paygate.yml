request:
  desc: ""
  tag: form
  attr:
    action: "https://www.paygate.co.za/paywebv2/process.trans"
    method: POST
  text:
    - type: hidden
    - PAYGATE_ID
    - REFERENCE
    - AMOUNT
    - CURRENCY
    - RETURN_URL
    - TRANSACTION_DATE
    - EMAIL
    - CHECKSUM
  values:
    - read_session: [paygate_amount,paygate_reference,email]
    - sql_values: select now() TRANSACTION_DATE
    - read_values:
        PAYGATE_ID: $paygate_id
        REFERENCE: $paygate_reference
        AMOUNT: $paygate_amount
        CURRENCY: ZAR
        RETURN_URL: $server_host/?path=paygate/response
        EMAIL: $email
        SECRET: $paygate_secret
    - sql_values: >
        select md5('$PAYGATE_ID|$REFERENCE|$AMOUNT|$CURRENCY|$RETURN_URL|$TRANSACTION_DATE|$EMAIL|$SECRET') CHECKSUM
    - trigger: .submit
    - clear_values: [paygate_amount,paygate_reference]

response:
  post:
    - done
