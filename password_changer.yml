## YAML Template.
---
forgot:
  name: Forgot Password
  desc: Reset your password
  height: 400
  width: 600
  type: wizard
  steps:
    - enter_email
    - check_otp: { url: /user/check_otp }
    - change

enter_email:
  name: Start Changing Password
  desc: >
    Enter the email you used to register on the system below to start 
    changing your password
  type: labelled_input_page
  inputs:
    - email
  actions:
    - next:
        post: 
          - write_session: email
          - sql_values: select first_name, last_name from user where email_address = '$email'
          - send_email: { subject: test me }
          - clear_values

change:
  type: labelled_input_page
  width: 700
  name: Change Password
  desc: 
    Please enter your new password and type it again to confirm it.
  inputs:
    - type: password_input
    - password
    - confirm_password
  actions:
    - next:
        post:
          - sql_exec: >
              update user set password = password('$password') 
              where email_address = '$email'
          - close_dialog: Password has been changed successfully
  

email:
  valid: in(user.email_address)


send_email:
  subject: One Time Password
  from: $support
  to: $first_name $last_name <$email>
  message: >
    Good day<br><br>
    You are currently trying to change your email address. 
    If you have not requested this, please inform the System Adminstrator.<br><br>
    Your One Time Password is : <b>$otp</b>. <br><br>
    Regards<br>
    Customer Operations
