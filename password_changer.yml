## YAML Template.
---
begin:
  type: wizard_page
  desc: |
    The system is going to send you a One Time Pin (OTP) to verify that you are
    not a robot. Please enter this OTP in the following screen to start changing
    your password.
  post:
    - sql_values: select email_address email, first_name, last_name from user where id = '$uid'
    - write_session: email,first_name,last_name
    - clear_values

change:
  name: Change Password
  type: wizard
  width: 600
  height: 400
  steps:
    - begin
    - check_otp: { url: /user/check_otp, clear: true }
    - update_password

forgot:
  name: Forgot Password
  desc: Reset your password
  height: 400
  width: 600
  type: wizard
  steps:
    - enter_email
    - check_otp: { url: /user/check_otp, clear: true }
    - update_password

enter_email:
  name: Start Changing Password
  desc: >
    Enter the email you used to register on the system below to start
    changing your password
  type: wizard_page
  inputs:
    - email: { valid: in(user.email_address) }
  next:
    post:
      - write_session: email

update_password:
  type: wizard_page
  width: 700
  name: Change Password
  desc: Please enter your new password and type it again to confirm it.
  inputs:
    - type: password_input
    - password
    - confirm_password
  navigate: [ update_password ]
  post:
    - read_session: email
    - sql_exec: >
        update user set password = password('$password')
        where email_address = '$email'
    - sql_values: select id uid from user where email_address = '$email'
    - write_session: uid
    - clear_values
    - close_dialog: Password has been changed successfully
  audit: $email
